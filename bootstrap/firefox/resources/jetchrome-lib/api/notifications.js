const apiUtils=require("api-utils");const self=require("self");const timer=require("api-utils/timer");const Trait=require("traits").Trait;const Services=require("utils-sf/services");function _Notification(b){if(!(this instanceof arguments.callee)){return new arguments.callee(b)}for(var a in b){this[a]=b[a]}if("url" in b){this.type=_Notification.TYPE_HTML}}_Notification.TYPE_HTML=1;_Notification.URL="content/notification.html";_Notification.MARGIN_LEFT=15;_Notification.MARGIN_TOP=25;_Notification.PADDING=15;_Notification.MAX_ON_SCREEN=6;_Notification.WIDTH_MIN=100;_Notification.WIDTH_MAX=316;_Notification.HEIGHT_MIN=40;_Notification.HEIGHT_MAX=152;_Notification.length=0;_Notification.active=[];_Notification.pending=[];_Notification.refresh=function(){var b=Services.appshell.hiddenDOMWindow.screen;var a=b.height-_Notification.MARGIN_TOP;_Notification.active.forEach(function(d){if(d.loaded){var c=d.window;c.moveTo(b.width-c.outerWidth-_Notification.MARGIN_LEFT,a=a-c.outerHeight-_Notification.PADDING)}})};_Notification.update=function(){while(_Notification.active.length<_Notification.MAX_ON_SCREEN&&_Notification.pending.length>0){var a=_Notification.pending.shift();a.createWindow();_Notification.active.push(a)}};_Notification.prototype={show:function(){_Notification.pending.push(this);_Notification.update()},cancel:function(){var a=this;if(this.window){this.window.close();_Notification.active=_Notification.active.filter(function(b){return b!=a})}else{_Notification.pending=_Notification.pending.filter(function(b){return b!=a})}_Notification.update()},createWindow:function(){var g=this;var f=[];const a=Services.appshell.hiddenDOMWindow.screen;var b={width:_Notification.WIDTH_MAX,height:_Notification.HEIGHT_MIN,top:a.height,left:a.width-_Notification.WIDTH_MAX-_Notification.MARGIN_LEFT,chrome:"yes",titlebar:"yes",close:"yes",popup:"yes",background:"white"};for(var c in b){f.push([c,b[c]].join("="))}const d=Services.ww.activeWindow||Services.wm.getMostRecentWindow("navigator:browser");var e=d.openDialog(this.type==_Notification.TYPE_HTML?this.url:self.data.url(_Notification.URL),null,f.join(","));e.moveTo(-1000,-1000);e.addEventListener("load",function(l){var h=l.target;h.title=g.name;h.body.style.overflow="hidden";h.body.style.display="inline-block";if(g.type!=_Notification.TYPE_HTML){if(g.icon){h.getElementById("icon").addEventListener("load",k,false);h.getElementById("icon").setAttribute("src",g.icon)}h.getElementById("title").innerHTML=g.title;h.getElementById("text").innerHTML=g.text;k()}var j=e.sizeToContent;function i(o,n){try{j()}catch(p){}if(e.innerWidth>_Notification.WIDTH_MAX){e.innerWidth=_Notification.WIDTH_MAX}else{if(e.innerWidth<_Notification.WIDTH_MIN){e.innerWidth=_Notification.WIDTH_MIN}}if(e.innerHeight>_Notification.HEIGHT_MAX){e.innerHeight=_Notification.HEIGHT_MAX}else{if(e.innerHeight<_Notification.HEIGHT_MIN){e.innerHeight=_Notification.HEIGHT_MIN}}}function k(){i(e.innerWidth,e.innerHeight);g.loaded=true;_Notification.refresh()}var m=timer.setTimeout(k,100);e.sizeToContent=k;e.sizeTo=i;e.addEventListener("fittocontent",e.sizeToContent,false);e.addEventListener("sizetocontent",e.sizeToContent,false);e.addEventListener("unload",function(){timer.clearTimeout(m);_Notification.active=_Notification.active.filter(function(n){return n.window!=e});_Notification.update();_Notification.refresh()},false);h.addEventListener("DOMSubtreeModified",function(n){timer.clearTimeout(m);m=timer.setTimeout(k,100)},false);k()},false);this.window=e;return this}};exports.Notification=_Notification;