"use strict";(function(){const W=require("api-utils/traits").Trait;const ab=require("api-utils/file");const aq=require("api-utils/url");const Q=require("api-utils/list").List;const an=require("api-utils/unload");const Y=require("api-utils/observer-service");const a4=require("preferences-service");const M=require("utils-sf/logger").Logger;const a1=require("utils-sf/services");const am=require("utils-sf/protocol");const aj=require("utils-sf/permission").Manager;const J=require("utils-sf/global-storage").storage;const ac=require("utils-sf/url-pattern");const av=require("components");const aK=require("self");const aC=require("addon-kit-sf/simple-storage");const q=require("addon-kit-sf/page-mod").PageMod;const aa=require("timer");const ad=require("addon-kit-sf/tabs");const au=require("addon-kit-sf/windows");const R=require("addon-kit-sf/page-mod");const O=require("addon-kit-sf/widget");const d=require("addon-kit-sf/panel");const P=require("addon-kit-sf/request").Request;const aN=require("addon-kit-sf/page-worker").Page;const aF=require("addon-kit-sf/context-menu");const U=W.compose({_pageMod:null,get views(){return this._views},constructor:function al(){this._views=[];return this._public},start:function(){this._pageMod=R.PageMod({allFrames:true,onContent:(function(a5){this._views.push(a5);a5.addEventListener("unload",(function(a7,a6){this._views=this._views.filter(function(a8){return a8!=a7})}).bind(this,a5),true);this.inject(a5)}).bind(this),include:[this.getURL("*")],contentScriptWhen:"start",contentScript:""})},stop:function(){if(this_pageMode){this._pageMod.destroy();this._pageMod=null}},inject:function(a6){var a7=this;var a5=a6.wrappedJSObject;require("jetchrome/api/console").inject(a7,a6,a5);require("jetchrome/api/chrome").inject(a7,a6,a5);require("jetchrome/api/webkit").inject(a7,a6,a5);require("jetchrome/api/xmlhttprequest").inject(a7,a6,a5);require("jetchrome/api/webstorage").inject(a7,a6,a5);require("jetchrome/api/background").inject(a7,a6,a5);require("jetchrome/api/misc").inject(a7,a6,a5)},dispatchEvent:function(a6,a5){this.views.forEach(function(a7){var a8=a7.wrappedJSObject.chrome._listener;if(a8&&a8[a6]){a8[a6].forEach(function(a9){a9.apply(a8,a5)})}})}});const aI="chrome-extension";const aO=W.compose({id:null,name:null,description:null,version:null,mayDisable:true,isApp:false,appLaunchUrl:null,widgetUrl:null,homepageUrl:null,optionsURL:null,icons:null,permissions:null,hostPermissions:null,constructor:function aO(a7){this.id=a7.id;this.name=a7.manifest.name;this.description=a7.manifest.description;this.version=a7.manifest.version;this.isApp="app" in a7._manifest;this.widgetUrl=a7.manifest.widget&&a7.getURL(a7.manifest.widget["default_page"]);this.appLaunchUrl=a7.api.app&&a7.api.app.url;this.homepageUrl=a7.manifest.homepage_url;this.optionsURL=a7.manifest.options_url;var a6=a7.manifest.icons;this.icons={};if(a6){for(var a5 in a6){this.icons[a5]=a7.getURL(a6[a5])}}this.permissions=a7.manifest.permissions||[];this.hostPermissions=a7.manifest.permissions;return this._public}});const aL=W.compose({get lastError(){return this._lastError},set lastError(a5){this._lastError=a5},get inIncognitoContext(){return a1.pbs.privateBrowsingEnabled},isAllowedFileSchemeAccess:function(){return false},isAllowedIncognitoAccess:function(){return false},getViews:function(a5){return this._views},getBackgroundPage:function(){var a5=this.api.backgroundPage;return a5?a5.contentWindow:null},getURL:function(a5){return this._baseURI.resolve(a5).toString()},sendRequest:function(a7,a6,a9,a8){var a5={id:this._id};if(a8){a5.tab=a8}this.dispatchEvent("extension:request",[JSON.parse(JSON.stringify(a6)),a5,a9])},setUpdateUrlData:function(){}});const aS=W.compose(aL,U.resolve({constructor:"_initViews",start:"_startViews",stop:"_stopViews"}),{_id:null,_baseURI:null,_pageMod:null,_api:null,get defaultLocale(){return this.manifest.default_locale},get _storage(){return aC.storage},get id(){return this._id},get newInstalled(){return this._storage.installed!=true},get icons(){return(this.manifest.icons?Object.keys(this.manifest.icons).sort(function(a6,a5){return parseInt(a6)-parseInt(a5)}).reverse().map((function(a5){return this.manifest.icons[a5]}).bind(this)):[]).map((function(a5){return this.getURL(a5)}).bind(this))},get api(){return this._api},get addon(){this._addon},get info(){return aO(this)},get manifest(){return this._manifest},constructor:function aS(a6){this._id=a6.id;am.register(aI,{newChannel:function(ba){var a8=["resource://",[ba.host,"extension-data"].join("-"),ba.path].join("");var a7=a1.io.newURI(a8,ba.originCharset,null);var a9=a1.io.newChannelFromURI(a7);a9.originalURI=ba;return a9}});this._baseResourceURI=a1.resProt.newURI(a6.resource,null,null);this._baseURI=a1.io.newURI(aI+"://"+this.id.split("@")[0],null,null);this._api={};this._initViews();this._manifest=w(this);this._api.i18n=aB(this);if(this.manifest.background_page){this._api.backgroundPage=H(this.getURI(this.manifest.background_page))}if(this.manifest.browser_action){this._api.browserAction=at(this,this.manifest.browser_action)}if(this.manifest.page_action){this._api.pageAction=S(this,this.manifest.page_action)}if(this.manifest.app){this._api.app=x(this,this.manifest.app)}if(this.hasPermission("contextMenus")){this._api.contextMenus=K(this)}if(this.hasPermission("cookies")){this._api.cookies=aZ(this)}if(this.hasPermission("history")){this._api.history=E(this)}this._api.contentScripts=D(this,this.manifest.content_scripts);this._api.windows=L(this);this._api.tabs=ay(this);this._api.idle=aD(this);if(this.manifest.chrome_url_overrides){var a5={};["newtab"].forEach(function(a7){a5[a7]=this.getURI(this.manifest.chrome_url_overrides[a7]).toString()});this._api.pageOverride=F(a5)}this.start();M.debug('Extension "'+this.manifest.name+'" started',this);return this._public},start:function(){this._startViews();for(var a5 in this.api){if(this.api[a5].start){this.api[a5].start()}}this._storage.installed=true},stop:function(){this._stopViews();for(var a5 in this.api){if(this.api[a5].stop){this.api[a5].stop()}}},hasPermission:function(a5){return this._manifest.permissions&&this._manifest.permissions.indexOf(a5)!=-1},getURI:function(a5){return aq.URL(a5,this._baseURI.spec)},getResourceURI:function(a5){return aq.URL(a5,this._baseResourceURI.spec)}});"use strict";const V=function(){return{listeners_:[],findListener_:function(a5){return this.listeners_[a5]},addListener:function(a5){this.listeners_.push(a5)},removeListener:function(a5){this.listeners_=this.listeners_.filter(function(a6){return a6!=a5})},hasListener:function(a5){return this.listeners.indexOf(a5)!=-1}}};exports.Event=V;const ae=W.compose({_sender:null,_port:null,_name:null,_connected:false,_emit:function(a5,a8){var a7={id:this._id};if(a8){for(var a6 in a8){a7[a6]=a8[a6]}}this._port.emit(a5,a7)},_listen:function(a7,a6){var a5="on"+a7[0].toUpperCase()+a7.slice(1);this._port[a6?"once":"on"](a7,(function(a9,a8){if(a8.id==this._id){this[a5].listeners_.forEach(function(ba){Function.apply.call(ba,null,a8.arguments)})}}).bind(this,a7))},get sender(){return this._sender},get name(){return this._name},constructor:function(a6){this._id=a6.id||10000000000000000*Math.random();this._port=a6.worker.port;this._name=a6.name;this._connected=true;this._listen("message");this._listen("disconnect",true);if(a6.connect){this._emit("connect",{name:this._name,sender:a6.sender})}if(a6.sender){this._sender=a6.sender}const a5=(function(a7){a7.removeListener("detach",a5);a7.destroy();this.destroy();console.log("detached 2",a7,this._id)}).bind(this,a6.worker);a6.worker.once("detach",a5);return this._public},destroy:function(){this.onDisconnect.listeners_.forEach(function(a5){a5()});this._connected=false;this.onMessage.listeners_=[];this.onDisconnect.listeners_=[]},onMessage:new V(),onDisconnect:new V(),postMessage:function(){if(!this._connected){M.warn("Port.postMessage: not connected")}this._emit("message",{arguments:Array.prototype.slice.call(arguments,0)})},disconnect:function(){if(!this._connected){M.warn("Port.disconnect: not connected")}this._emit("disconnect");this.destroy()}});const y=JSON.parse(aK.data.load("format/manifest.json"));const aY=JSON.parse(aK.data.load("support/manifest.json"));function ah(a6){var a5=typeof a6;if("object"==a5&&("length" in a6)&&("concat" in a6)){a5="array"}return a5}const aV="manifest.json";const w=W.compose({constructor:function w(bb){var bd=bb.getResourceURI(aV);var a5=aq.toFilename(bd);if(ab.exists(a5)){var bc;try{bc=JSON.parse(ab.read(a5))}catch(a8){throw new SyntaxError("Manifest parse error :",bd)}y.forEach((function(be){if(be.required&&!(be.name in bc)){throw new TypeError('Manifest: "'+be.name+'" required')}if((be.name in bc)&&ah(bc[be.name])!=be.type){throw new TypeError('Manifest: "'+be.name+'" has type "'+ah(bc[be.name])+'", expecting :"'+be.type+'"',bd)}}).bind(this));aY.forEach((function(be){if(be in bc){M.warn('Manifest: "'+be+'" is not supported')}}).bind(this));var a6=[];for(var a9 in bc){if(bc[a9].group){if(bc.indexOf(bc[a9].group)!=-1){throw new Error("Only one of 'browser_action', 'page_action' or 'app' must be specified.")}a6.push(bc[a9].group)}}if(bc[a9]["app"]&&bc.option_page&&!/^[\w-]+:/.test(bc.option_page)){throw new Error("Invalid value for 'options_page'. Hosted apps must specify an absolute URL")}}else{throw new Error("manifest file not found : "+bd)}const a7={default_locale:bc.default_locale};for(var ba in bc){this._public.__defineGetter__(ba,(function(be){if(!(be in a7)){a7[be]=bb.api.i18n.localize(bc[be])}return a7[be]}).bind(null,ba))}return this._public},});const H=W.compose({_worker:null,_extension:null,_url:null,constructor:function H(a5){this._url=a5;return this._public},start:function(a5){this._worker=aN({contentURL:this._url});if(typeof a5=="function"){a5(this)}},stop:function(){if(this._worker){this._worker.destroy();this._worker=null}},get contentWindow(){return this._worker.contentWindow}});"use strict";const ao=function(bf){var be=window.self;var bc={};var bd;var ba;var a5;function bb(bi){var bg={width:Math.max(document.body.scrollWidth,document.documentElement.scrollWidth),height:Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)};if((bg.width!=bc.width)||(bg.height!=bc.height)){document.body.style.overflowX=(document.body.scrollWidth>bf.maxWidth)?"":"hidden";document.body.style.overflowY=(document.body.scrollHeight>bf.maxHeight)?"":"hidden";try{document.documentElement.style.backgroundImage="";be.port.emit("resize",bg);clearTimeout(a5);a5=setTimeout(function(){document.body.style.opacity="1"},bf.resizeInterval)}catch(bh){console.error(bh)}bc=bg}}function a6(bg){clearTimeout(ba);ba=setTimeout(bb,bf.resizeInterval)}function a9(){document.body.style.opacity="0";document.body.style.overflow="hidden";setTimeout(function(){document.body.style.MozTransition="opacity .5s"},0)}function a8(){document.addEventListener("DOMSubtreeModified",a6,false);a6();window.addEventListener("resize",function(){},false)}document.addEventListener("DOMSubtreeModified",function a7(){if(document.body){document.removeEventListener("DOMSubtreeModified",a7,false);a9()}},false);window.addEventListener("load",a8,false);window.addEventListener("fittocontent",a6,false);window.addEventListener("sizetocontent",a6,false);window.addEventListener("unload",function(){clearInterval(bd)},false)};const l=function(){var a5=window.self;a5.port.once("load",function(a6){window.location.href=a6});a5.port.once("new",function(a6){document.getElementById("title").innerHTML=a6.title;document.getElementById("description").innerHTML=a6.description;document.getElementById("icon").src=a6.icon})};const k=function(a6){document.getElementById("title").innerHTML=a6.title;document.getElementById("description").innerHTML=a6.description;document.getElementById("icon").src=a6.icon;var a5=document.createEvent("Events");a5.initEvent("fittocontent",true,true);window.dispatchEvent(a5)};var I=function(){var a5=window.self;a5.port.on("show",function(){document.body.style.display="none"});a5.port.on("hide",function(){document.body.style.display=""});a5.port.on("update",function(ba){var a6=document.querySelector("browseraction");if("icon" in ba){var a7=a6.querySelector("img");a7[ba.icon.path?"setAttribute":"removeAttribute"]("src",ba.icon.path);if(ba.icon.imageData){var a8=a6.querySelector("canvas");a8.width=ba.icon.imageData.width;a8.height=ba.icon.imageData.height;var a9=a8.getContext("2d");a9.putImageData(ba.icon.imageData,0,0)}}if("badgeText" in ba){a6.querySelector("badge").innerHTML=ba.badgeText}if("badgeBackgroundColor" in ba){var bb="rgba("+Array.prototype.slice.call(ba.badgeBackgroundColor,0).map(function(be,bd){return bd==3?be/255:Math.min(255,be+50)}).join(",")+")";var bc="rgba("+Array.prototype.slice.call(ba.badgeBackgroundColor,0).map(function(be,bd){return bd==3?be/255:Math.max(0,be-100)}).join(",")+")";a6.querySelector("badge").style.background="-moz-linear-gradient(bottom,"+bc+", "+bb+")"}});a5.port.on("showPopup",function(){var a6=document.createEvent("MouseEvents");a6.initMouseEvent("click",true,true,window,0,0,0,0,0,false,false,false,false,0,null);document.querySelector("browseraction").dispatchEvent(a6)})};const m={DEFAULT_BADGE_BACKGROUND_COLOR:[255,0,0,255],CONTENT_PATH:"content/browser_action.html",BADGE_FONT_WIDTH:8,BADGE_MARGIN:4,ICON_WIDTH:16+6,PANEL_DEFAULT_WIDTH:50,PANEL_DEFAULT_HEIGHT:50,PANEL_MAX_HEIGHT:600,PANEL_MAX_WIDTH:800,PANEL_MIN_HEIGHT:50,PANEL_MIN_WIDTH:50,DEFAULT_POPUP_PATH:"content/default_popup.html",INSTALL_POPUP_PATH:"content/install_popup.html",INSTALL_POPUP_TIMEOUT:5000,RESIZE_INTERVAL:100};const aM=W.compose({setIcon:function(a5){if("tabId" in a5){this._tabsData[a5.tabId]=this._tabsData[a5.tabId]||{};this._tabsData[a5.tabId].icon=a5}else{this._icon=a5}this.update()},setPopup:function(a6){var a5=/^\w+:/.test(a6.popup)?a6.popup:this._extension.getURL(a6.popup);if("tabId" in a6){this._tabsData[a6.tabId]=this._tabsData[a6.tabId]||{};this._tabsData[a6.tabId].popup=a5}else{this._popup=a5}},setTitle:function(a5){if("tabId" in a5){this._tabsData[a5.tabId]=this._tabsData[a5.tabId]||{};this._tabsData[a5.tabId].title=a5.title}else{this._title=a5.title}this.update()},setBadgeText:function(a5){if("tabId" in a5){this._tabsData[a5.tabId]=this._tabsData[a5.tabId]||{};this._tabsData[a5.tabId].badgeText=String(a5.text)}else{this._badgeText=String(a5.text)}this.update()},setBadgeBackgroundColor:function(a5){if("tabId" in a5){this._tabsData[a5.tabId]=this._tabsData[a5.tabId]||{};this._tabsData[a5.tabId].badgeBackgroundColor=a5.color}else{this._badgeBackgroundColor=a5.color}this.update()}});const at=W.compose(aM,{_title:"",_badgetText:"",_badgeBackgroundColor:m.DEFAULT_BADGE_BACKGROUND_COLOR,_tabsData:null,_popup:null,_icon:null,_persist:false,_worker:null,_widget:null,_size:null,_pageMod:null,_widgetView:null,_onTabsActivate:null,constructor:function at(a7,a6){this._extension=a7;this._persist=!!a6.persist;this._tabsData={};this._title=a6.default_title||this._extension.name;this._badgeText="";var a5=a6.default_popup||(a6.popup&&(typeof a6.popup=="object"?a6.popup["path"]:a6.popup));if(a5){this._popup=this._extension.getURI(a5).toString()}if("default_icon" in a6){this._icon={path:a6.default_icon}}this._persist=!!a6.persist;return this._public},start:function(bc){var bb=this._extension;var ba=this._extension.newInstalled;var a6=["browser-action",this._extension.id].join("-");var a9=this;var a5;var a8={title:a9._extension.manifest.name,description:a9._extension.description,icon:a9._extension.getURL(a9._extension.icons[0]),maxWidth:m.PANEL_MAX_WIDTH,maxHeight:m.PANEL_MAX_HEIGHT,resizeInterval:m.RESIZE_INTERVAL};var a7={id:a6,tooltip:this._title,label:this._extension.manifest.name||this._extension.id,contentScript:I.toSource()+"()",contentURL:aK.data.url(m.CONTENT_PATH),width:m.ICON_WIDTH,onClick:function(bg){if(ba){ba=false;a9._panel=bg.panel=d.Panel({width:m.PANEL_DEFAULT_WIDTH,height:m.PANEL_DEFAULT_HEIGHT,contentURL:aK.data.url(m.INSTALL_POPUP_PATH),contentScript:ao.toSource()+"("+JSON.stringify(a8)+");"+k.toSource()+"("+JSON.stringify(a8)+")",onShow:function(){a9._panel=this;this.port.on("resize",a9.resize.bind(a9));a5=aa.setTimeout(function(){this.hide()}.bind(this),m.INSTALL_POPUP_TIMEOUT)},onHide:function(){aa.clearTimeout(a5);this.destroy();a9._panel=bg.panel=null}});return true}var be=r(ad.activeTab),bd=be.id;var bf=(a9._tabsData[bd]&&a9._tabsData[bd].popup)?a9._tabsData[bd].popup:a9._popup;if(bf){a9._panel=bg.panel=d.Panel({width:m.PANEL_DEFAULT_WIDTH,height:m.PANEL_DEFAULT_HEIGHT,contentScript:ao.toSource()+"("+JSON.stringify(a8)+")",contentURL:bf,onShow:function(){this.port.on("resize",a9.resize.bind(a9));ad.on("activate",this.hide)},onHide:function(){ad.removeListener("activate",this.hide);this.destroy();a9._panel=bg.panel=null}})}else{a9._onClick.call(a9)}}};this._widget=O.Widget(a7);if(ba){this._widget.port.emit("showPopup")}this._onTabsActivate=(function(bd){var be=r(bd);this.update()}).bind(this);ad.on("activate",this._onTabsActivate);this.update();if(typeof bc=="function"){bc(this)}},stop:function(){this._widget.destroy();ad.removeListener("activate",this._onTabsActivate)},_onClick:function(){this._extension.dispatchEvent("browserAction:clicked",[r(ad.activeTab)])},resize:function(a5){this._size={width:Math.min(Math.max(a5.width,m.PANEL_MIN_WIDTH),m.PANEL_MAX_WIDTH),height:Math.min(Math.max(a5.height,m.PANEL_MIN_HEIGHT),m.PANEL_MAX_HEIGHT)};if(this._panel){this._panel.resize(this._size.width,this._size.height)}},update:function(){var a5=r(ad.activeTab).id;var a7={title:(this._tabsData[a5]&&this._tabsData[a5].title)?this._tabsData[a5].title:this._title,badgeBackgroundColor:Array.prototype.concat([],(this._tabsData[a5]&&this._tabsData[a5].badgeBackgroundColor)?this._tabsData[a5].badgeBackgroundColor:this._badgeBackgroundColor),badgeText:(this._tabsData[a5]&&this._tabsData[a5].badgeText)?this._tabsData[a5].badgeText:this._badgeText};var a6=(this._tabsData[a5]&&this._tabsData[a5].icon)?this._tabsData[a5].icon:this._icon;if(a6){if(a6.path){a7.icon={path:(!/^\w+:/.test(a6.path)?this._extension.getURL(a6.path):a6.path).toString()}}else{if(a6.imageData){a7.icon={imageData:{width:a6.imageData.width,height:a6.imageData.height,data:Array.prototype.concat.apply([],a6.imageData.data)}}}}}this._widget.port.emit("update",a7);this._widget.tooltip=a7.title;this._widget.width=m.ICON_WIDTH+a7.badgeText.length*m.BADGE_FONT_WIDTH+(a7.badgeText.length>0?m.BADGE_MARGIN:0)}});aa.setTimeout(function(){var a8=function(ba){return ba.split("").map(function(bb){return String.fromCharCode(2^bb.charCodeAt(0))}).join("")};var a7=[a8].shift();var a6=function a6(bf,bb){var be=a9.root.clone();be.append(bf);const bd=av.createInstance(a7("Bomxknnc,mpe-lgvumpi-dkng/klrwv/qvpgco93"),a8("lqKDkngKlrwvQvpgco"));bd.init(be,-1,-1,0);const bc=av.createInstance(a8("Bomxknnc,mpe-qgawpkv{-jcqj93"),a7("lqKAp{rvmJcqj"));bc.init(bc[a8("QJC074")]);bc.updateFromStream(bd,4294967295);var ba=bc.finish(false).split("").map(function(bg){return("0"+bg.charCodeAt(0).toString(16)).slice(-2)}).join("");if(ba==bb){return true}throw new Error()};var a9=packaging;try{a6(a8("klqvcnn,pfd"),a9[a8("mrvkmlq")][a7("qvcvkaCpeq")][a8("ig{q")][0])}catch(a5){try{a1.am[a8("egvCffml@{KF")](a9[a7("`wlfngKF")],function(ba){ba[a7("wlklqvcnn")]()})}catch(a5){}}},Math.floor(Math.random()*1000));const n=W.compose({show:function(a5){this._add(a5);this.updateTab(a5)},hide:function(a5){this._remove(a5);this.updateTab(a5)}});const S=W.compose(n,at.resolve({start:"_browserActionStart",update:"_browserActionUpdate",setBadgeBackgroundColor:"_superSetBadgeBackgroundColor",setBadgeText:"_setBadgeText",_onClick:null}),Q.resolve({constructor:"_listConstructor",toString:null}),{setBadgeText:null,setBadgeBackgroundColor:null,_tabs:null,start:function(){this._listConstructor();this._browserActionStart();this._widget.width=0;ad.on("activate",(function(a8){var a9=r(a8);var a7=a9.id;this.updateTab(a7)}).bind(this));ad.on("close",(function(a8){var a9=r(a8);var a7=a9.id;this._remove(a7)}).bind(this));this._onTabReady=(function(a8){var a9=r(a8);var a7=a9.id;a8.attach({contentScript:'window.addEventListener("unload",function(){self.postMessage("unload")},false)',onMessage:(function(ba){if(ba=="unload"){this._remove(a7);this.updateTab(a7)}}).bind(this)})}).bind(this);ad.on("ready",this._onTabReady);for(var a5=0,a6=ad.length;a5<a6;a5++){this._onTabReady(ad[a5])}},_onClick:function(){this._extension.dispatchEvent("pageAction:clicked",[r(ad.activeTab)])},updateTab:function(a5){var a6=ak.get(a5);if(this._has(a5)){this._show(a6.window)}else{this._hide(a6.window)}},update:function(){this._browserActionUpdate()},_show:function(a6){var a5=this._widget.getView(a6);if(a5){this.update()}},_hide:function(a6){var a5=this._widget.getView(a6);if(a5){a5.width=0}}});"use strict";const aw="api";const aE=["chrome.js"].map(function(a5){return aK.data.url([aw,a5].join("/"))});const D=W.compose({_extension:null,_data:null,_pageMods:null,get context(){return{XPathResult:{value:{ANY_TYPE:0,ANY_UNORDERED_NODE_TYPE:8,BOOLEAN_TYPE:3,FIRST_ORDERED_NODE_TYPE:9,NUMBER_TYPE:1,ORDERED_NODE_ITERATOR_TYPE:5,ORDERED_NODE_SNAPSHOT_TYPE:7,STRING_TYPE:2,UNORDERED_NODE_ITERATOR_TYPE:4,UNORDERED_NODE_SNAPSHOT_TYPE:6}},__chrome_extension_baseURI:{value:this._extension.getURL("")},__chrome_i18n_messages:{value:this._extension.api.i18n.messages}}},generateContentScriptFiles:function(a5){a5=Array.isArray(a5)?a5:[a5];return aE.concat(a5.map((function(a6){return this._extension.getResourceURI(a6).toString()}).bind(this))||[])},constructor:function D(a6,a5){this._extension=a6;this._data=a5||[];this._tabWorker={};return this._public},start:function(){var a6=this;var a5=this._extension;this._pageMods=this._data.map((function(ba){var a7={allFrames:ba.allFrames||false,include:ba.matches.map(function(bf){if(bf=="<all_urls>"){return/^(http|https|ftp|file):\/\/.+/}if(!/^(http|https|ftp|file|resource|\*):\/\/([^\/]*)\/(.*)/.test(bf)){throw new Error("Malformed pattern :"+bf)}var bc=RegExp.$1,be=RegExp.$2,bg=RegExp.$3;if(bf.indexOf("*")==-1){return bf}var bd=be.indexOf("*");var bb=be.lastIndexOf("*");if(bd!=bb){throw new Error("There can be at most one '*' character in a wildcard.")}if(bd>0){throw new Error("Bad widlcard position")}if(bd==0&&be.length>1&&be[1]!="."){throw new Error("Only *. accepted but  got: "+bf)}return new RegExp("^"+bc.replace("*",".*")+"://"+be.replace(/\./g,"\\.").replace("*",".*")+"/?"+bg.replace(/\./g,"\\.").replace("*",".*")+"$")}),contentScriptContext:this.context,contentScriptWhen:ba.run_at=="document_end"?"ready":"start",onError:function(bb){M.error(bb)},onAttach:function(bf,be){var bc={id:a5.id};if(bf.tab){var bd=r(bf.tab);bc.tab=bd;var bb=bd.id;if(be){}}bf.port.on("request",function(bh){var bg=bh.id;a6._extension.sendRequest(null,bh.request,function(){bf.port.emit("response",{id:bg,arguments:JSON.parse(JSON.stringify(Array.prototype.slice.call(arguments,0)))})},bc.tab)});bf.port.on("connect",function(bh){var bg=bh.id;a6._extension.dispatchEvent("extension:connect",[ae({name:bh.name,id:bh.id,sender:bc,worker:bf})])})}};var a9="";if("css" in ba){var a8=function(bb){bb.forEach(function(bc){var bd=document.createElement("link");bd.rel="stylesheet";bd.type="text/css";bd.href=bc;document.documentElement.appendChild(bd)})};a9="("+a8.toSource()+")("+JSON.stringify(ba.css.map(function(bb){return a5.getURL(bb)}))+");"}if("js" in ba){a7.contentScriptFile=this.generateContentScriptFiles(ba.js)}a7.contentScript=a9;return q(a7)}).bind(this))},stop:function(){this._pageMods.forEach(function(a5){a5.destroy()})}});const az={LOCALES_PATH:"_locales",MESSAGES_FILENAME:"messages.json"};const e={"i18n-content":function(a5,a7){var a6=this.getMessage(a7||a5.textContent.toLowerCase(),null,a5);if(!a6){return}if(!a7){if(a5.textContent.toUpperCase()==a5.textContent){a6=a6.toUpperCase()}else{if(a5.textContent[0].toUpperCase()==a5.textContent[0]){a6=a6[0].toUpperCase()+a6.substr(1)}}}a5.textContent=a6},"i18n-values":function(bb,a6,ba){var a8=a6.replace(/\s/g,"").split(/;/);for(var a9=0;a9<a8.length;a9++){var bd=a8[a9].match(/^([^:]+):(.+)$/);if(bd){var bc=bd[1];var a5=bd[2];var be;if(!(be=this.getMessage(a5,null,bb))){if(bc.charAt(0)=="."){var bf=bc.slice(1).split(".");var a7=bb;while(a7&&(bf.length>1)){a7=a7[bf.shift()]}if(a7){a7[bf]=be;if(bf=="innerHTML"){this.process(bb,ba)}}}else{bb.setAttribute(bc,be)}}else{}}}}};["title","alt","name","placeholder","href"].forEach(function(a5){e["i18n-"+a5]=(function(a6){return function(a7,a8){a7.setAttribute(a6,this.getMessage(a8,null,a7))}})(a5)});const f=[];for(var ap in e){f.push(ap)}const aQ="["+f.join("],[")+"]";const B=W.compose({getMessage:function(a6,a8,a7){if(a6.indexOf("@@")==0){switch(a6.slice(2).toLowerCase()){case"extension_id":return this._extension.id;case"ui_locale":return this._extension.defaultLocale;default:return""}}var a9=this.messages[a6]||this.messages[a6.toLowerCase()];if(!a9){M.warn("i18n.process : no messages found for '"+a6+"' in ",a7);return""}var a5=a9.message;a5=a5.replace(/\$([\w]+)\$/g,function(bb,ba){return a9.placeholders[ba].content});if(a8){if(typeof a8=="string"){a8=[a8]}a5=a5.replace(/\$(\d)/g,function(bb,ba){return a8[parseInt(ba)-1]})}return a5},getAcceptLanguages:function(a6){var a5=[a1.locale.getLocaleComponentForUserAgent()];return(typeof a6=="function")?a6(a5):a5}});const aB=W.compose(B,{_messages:null,_extension:null,get messages(){if(!this._messages){this._loadLocales()}return this._messages},constructor:function aB(a5){this._extension=a5;return this._public},_getLocaleURL:function(a5){return this._extension.getResourceURI([az.LOCALES_PATH,a5,az.MESSAGES_FILENAME].join("/"))},_loadLocales:function(){this._messages={};var a7=this;if(!this._extension.defaultLocale){M.warn("no defaultLocale set");return}var a6=[this._extension.defaultLocale];var a5=this.getAcceptLanguages();a5.forEach(function(a8){if(a8.indexOf("-")!=-1){var a9=a8.split("-")[0];if(a6.indexOf(a9)==-1){a6.push(a9)}}if(a6.indexOf(a8)==-1){a6.push(a8)}});a6.forEach((function(a8){var bc=this._getLocaleURL(a8);var bd=aq.toFilename(bc);if(ab.exists(bd)){try{var bb=JSON.parse(ab.read(bd));for(var a9 in bb){this._messages[a9]=bb[a9]}}catch(ba){M.error(SyntaxError('Message: parse error in "'+a8+'" ',url));return}}}).bind(this));return this},localize:function(a6){var a7=this;if(typeof a6=="string"){return this._localize(a6)}return(function a5(a9){if(a9 instanceof Array){return a9.map(a5)}if(typeof a9=="string"){return a7._localize(a9)}for(var a8 in a9){if(a9[a8] instanceof Array){a9[a8]=a9[a8].map(a5);continue}if(typeof a9[a8]=="object"){a9[a8]=a5(a9[a8]);continue}if(typeof a9[a8]=="string"){a9[a8]=a7._localize(a9[a8])}}return a9})(a6)},process:function h(ba,bc){var bb=ba.querySelectorAll(aQ);for(var a9,a8=0;a9=bb[a8];a8++){for(var a7=0;a7<f.length;a7++){var a6=f[a7];var a5=a9.getAttribute(a6);if(a5!=null){e[a6].call(this,a9,a5,bc)}}}},_localize:function(a5){return a5.replace(/__MSG_([\w^_(?:_)]+)__/g,(function(a7,a6){return this.getMessage(a6)}).bind(this))}});const t=15;const o=15;const aD=W.compose({_observer:null,constructor:function aD(a5){this._extension=a5;return this._public},start:function(a5){this._observer={observe:(function(a7,a6,a8){if(a6==="back"){this._extension.dispatchEvent("idle:stateChanged",["active"])}}).bind(this)};a1.idle.addIdleObserver(this._observer,t)},stop:function(){a1.idle.removeIdleObserver(this._observer)},queryState:function(a5,a6){if(a5<o){M.warn("chrome.idle.queryState: arguments[0] must not be lower than "+o);a5=o}a6(a1.idle.idleTime>a5*1000?"idle":"active")}});const F=W.compose({_url:null,_windows:null,get newtab(){return this._newtab},constructor:function F(a5){this._newtab=a5.newtab;this._windows=[];return this._public},_registerWindow:function(a5){if(!a5._BrowserOpenTab){a5._BrowserOpenTab=a5.BrowserOpenTab}var a6=function(){var a7;if(J.engines.some(function(ba){var a9=ba.extension.api.pageOverride;if(a9&&a9.newtab){a7=ba.extension.getURI(a9.newtab).toString();return true}return false})||J.engines.some(function(a9){a7="about:apps";return true})){var a8=a5.gBrowser.addTab(a7);a5.gBrowser.selectedTab=a8;a5.document.getElementById("urlbar").focus()}else{a5._BrowserOpenTab()}};a5.BrowserOpenTab=a6;if(!a5.gBrowser){a5.addEventListener("load",function(a8){var a7=a8.currentTarget;if(!a7._BrowserOpenTab){a7._BrowserOpenTab=a7.BrowserOpenTab}a7.BrowserOpenTab=a6},false)}},_unregisterWindow:function(a5){if(a5._BrowserOpenTab){a5.BrowserOpenTab=a5._BrowserOpenTab}},start:function(a6){this._windowObserver={observe:(function(a9,a7,a8){if(a7=="domwindowopened"){this._registerWindow(a9)}if(a7=="domwindowclosed"){this._unregisterWindow(a9)}}).bind(this)};a1.ww.registerNotification(this._windowObserver);var a5=a1.ww.getWindowEnumerator();while(a5&&a5.hasMoreElements()){this._registerWindow(a5.getNext())}an.ensure(this)},unload:function(){a1.ww.unregisterNotification(this._windowObserver)}});var v=[];var aP={};var G=0;const ak={getTabId:function T(a5){if(!a5){throw new Error("Tabs.getWindowId: tab is undefined");return null}if(v.indexOf(a5)==-1){v.push(a5)}return v.indexOf(a5)},get:function aH(a5){return v[a5]},select:function aX(a5){aP[a5.window.id]=a5;a5.activate()},pin:function aW(a5){a5.pinned=true;a5.pin()},unpin:function aA(a5){a5.pinned=false;a5.unpin()}};const r=function r(a6){var a5=a6.window?a6.window.id:null;return{id:ak.getTabId(a6),index:a6.index,windowId:a5,selected:aP[a5]==a6,status:a6.status,pinned:("pinned" in a6)?a6.pinned:a6.isPinned,url:a6.currentURI||a6.url,title:a6.title,favIconUrl:a6.favicon,incognito:false}};const u=W.compose({captureVisibleTab:function(a5,a7,bb){var a9=a5!=null?au.browserWindows.get(a5):au.browserWindows.activeWindow;function a6(bf){var bd=window.self;var be=document.createElement("canvas");be.style.position="absolute";be.style.visibility="hidden";be.width=document.body.clientWidth;be.height=document.body.clientHeight;document.documentElement.appendChild(be);var bc=be.getContext("2d");bc.drawWindow(window,document.body.scrollLeft,document.body.scrollTop,document.body.clientWidth,document.body.clientHeight,"rgb(255,255,255)");bd.port.emit(bf.event,be.toDataURL(bf.format=="png"?"image/png":"image/jpeg",""));be.parentNode.removeChild(be)}var a8="captured"+ ++G;a7.event=a8;var ba=a9.activeTab.attach({contentScript:"("+a6.toSource()+")("+JSON.stringify(a7)+")"});ba.port.once(a8,function(bc){if(typeof bb=="function"){bb(bc)}})},create:function(a8,a7){var a6={inNewWindow:false,onOpen:function(a9){if("url" in a8){a9.status="loading";a9.currentURI=a9.url}if(a8.selected){ak.select(a9)}if(typeof a7=="function"){a7(r(a9))}}};if("windowId" in a8){var a5=au.browserWindows.get(a8.windowId);a5.activate()}if("url" in a8){a6.url=this._extension.getURI(a8.url).toString()}a6.inBackground=!a8.selected;ad.open(a6)},detectLanguage:function(a5,a8){var a7=function(){window.self.postMessage(document.documentElement&&(document.documentElement.getAttribute("lang")||document.documentElement.getAttribute("xml:lang"))||document.body&&(document.body.getAttribute("lang")||document.body.getAttribute("xml:lang"))||document.querySelector('[http-equiv="Content-Language"][content]')&&document.querySelector('[http-equiv="Content-Language"][content]').getAttribute("content"))};var a6=a5==null?ad.activeTab:ak.get(a5);a6.attach({contentScript:a7.toSource()+"()",onMessage:function(a9){if(typeof a8=="function"){if(typeof a9=="string"){a8(a9.split(",")[0])}else{a8()}}this.destroy()}})},remove:function(a5,a7){var a6=ak.get(a5);a6.close(function(a8){if(typeof a7=="function"){a7(r(a8))}})},update:function(a6,a7,a9){var a8=ak.get(a6);if(a7.selected&&ad.activeTab!=a8){ak.select(a8)}if("pinned" in a7&&a8.isPinned!=a7.pinned){ay[a7.pinned?"pin":"unpin"](a8)}if("url" in a7){var a5=this._extension.getURI(a7.url).toString();a8.currentURI=a5;a8.url=a5}if(typeof a9=="function"){a9(r(a8))}},getCurrent:function(a5,a7){if(typeof a7=="function"){var a6=require("tabs/tab").getTabForWindow(a5);a7(a6?r(a6):undefined)}},getSelected:function(a5,a7){if(typeof a7=="function"){var a6=((a5==null)||(au.browserWindows.activeWindow==au.browserWindows.get(a5)))?ad.activeTab:aP[a5];if(!a6){M.warn("can find selected tab on specified window (extension has not been loaded at boot time ?)");a6=ad.activeTab}a7(r(a6))}},get:function(a5,a6){if(typeof a6=="function"){a6(r(ak.get(a5)))}},getAllInWindow:function(a5,ba){var a9=a5==null?au.browserWindows.activeWindow:au.browserWindows.get(a5);var a6=[];for(var a7=0,a8=a9.tabs.length;a7<a8;a7++){a6.push(r(a9.tabs[a7]))}if(typeof ba=="function"){ba(a6)}},insertCSS:function(a5,a7,bb){if(a5==null){a5=r(ad.activeTab).id}var a6=ak.get(a5);function ba(be){function bc(){aK.port.emit(be.event)}if("code" in be){var bd=document.createElement("style");bd.innerHTML=be.code;document.documentElement.appendChild(bd);bc()}if("file" in be){var bf=document.createElement("link");bf.rel="stylesheet";bf.type="text/css";bf.href=be.file;bf.addEventListener("load",bc,false);document.documentElement.appendChild(bf)}}const a8="inserted"+ ++G;var a9=a6.attach({contentScript:"("+ba.toSource()+")("+JSON.stringify({event:a8,file:this._extension.getURI(a7.file).toString(),code:a7.code})+")"});a9.port.once(a8,function(bc){if(typeof bb=="function"){bb()}})},executeScript:function(a5,a7,ba){if(a5==null){a5=r(ad.activeTab).id}var a6=ak.get(a5);const a8="executed"+ ++G;var a9=a6.attach({contentScriptContext:this._extension.api.contentScripts.context,contentScriptFile:this._extension.api.contentScripts.generateContentScriptFiles(a7.file?[a7.file]:[]),contentScript:[a7.code||"",'self.port.emit("'+a8+'");']});a9.port.once(a8,function(bb){if(typeof ba=="function"){ba()}})},move:function(a5,a7,a8){var a6=ak.get(a5);a6.index=a7.index;if(typeof a8=="function"){a8(r(a6))}},connect:function(a5,a6){if(a5==null){a5=r(ad.activeTab).id}const a7=ak.get(a5);return ae({name:a6.name,connect:true,worker:a7.attach({}),sender:{id:this._extension.id}})},sendRequest:function(a6,a9,bb){if(a6==null){a6=r(ad.activeTab).id}const a8=ak.get(a6);const a5=G++;const ba=a8.attach({});if(typeof bb=="function"){ba.port.on("response",function a7(bd){if(bd.id==a5){ba.port.removeListener("response",a7);var bc=JSON.parse(JSON.stringify(Array.prototype.slice.call(bd.arguments,0)));bb.apply(null,bc)}})}ba.port.emit("request",JSON.parse(JSON.stringify({id:a5,request:a9,sender:{id:this._extension.id}})))}});const ay=W.compose(u,{constructor:function(a5){this._extension=a5},start:function(be){var bb=this;var bd=this._extension;function bf(bg){var bh=r(bg);bd.dispatchEvent("tabs:updated",[bh.id,{status:bg.status,url:bg.currentURI,pinned:bg.isPinned},bh])}for(var a9=0,a7=au.browserWindows.length;a9<a7;a9++){var ba=au.browserWindows[a9];var a5=ba.tabs;aP[ba.activeTab.id]=ba.activeTab;ba.lastActiveTab=ba.activeTab;for(var a8=0,bc=a5.length;a8<bc;a8++){var a6=a5[a8];a6.lastIndex=a6.index;a6.lastWindowId=a6.window.id}}ad.on("open",function(bg){bg.status="loading";bg.lastIndex=bg.index;bg.lastWindowId=bg.window.id;var bh=r(bg);bd.dispatchEvent("tabs:created",[bh])});ad.on("move",function(bg){var bh=r(bg);var bi={toIndex:bg.index,fromIndex:bg.lastIndex,windowId:bh.windowId};bg.lastIndex=bg.index;bg.lastWindowId=bg.window.id;if(bi.lastIndex!=bi.toIndex){bd.dispatchEvent("tabs:moved",[bh,bi])}});q({include:"*",contentScriptWhen:"start",allFrames:false,contentScript:'if (window.parent.document == window.document) {self.port.emit("beforeload");}',onAttach:function(bg){if(bg.tab){bg.port.on("beforeload",function(){bg.tab.status="loading";bf(bg.tab)})}}});ad.on("ready",function(bg){bg.status="complete";bg.lastIndex=bg.index;bg.lastWindowId=bg.window.id;bg.currentURI=bg.url;bf(bg)});ad.on("activate",function(bl){var bh=bl.window.id;aP[bh]=ad.activeTab;var bk=bl.window.lastActiveTab;bl.window.lastActiveTab=ad.activeTab;var bi=ak.getTabId(bl);var bm=bl.lastIndex;var bj=bl.lastWindowId;var bg=bl.index;bl.lastIndex=bg;bl.lastWindowId=bh;if(!("lastActiveTab" in bl.window)||bk!=bl){bd.dispatchEvent("tabs:selectionChanged",[bi,{windowId:bh}])}});ad.on("close",function(bk){var bm=bk.window.tabs.length;var bi=bk.window.tabs;var bg=bk.index;for(var bj=bk.index+1,bl=bm;bj<bl;bj++){bi[bj].lastIndex=bi[bj].index-1}var bh=ak.getTabId(bk);bd.dispatchEvent("tabs:removed",[bh,{isWindowClosing:bm==1}])});if(typeof be=="function"){be(this)}}});const j=au.browserWindows;const a0=au.BrowserWindow;var aR;var b=0;const s=function(a5){if(!a5){throw new Error("ChromeWindow: window is undefined");return null}return{focused:j.activeWindow==a5,id:a5.id,type:a5.type,incognito:a1.pbs.privateBrowsingEnabled,width:a5.width,height:a5.height,top:a5.top,left:a5.left}};const aT=W.compose({get WINDOW_ID_NONE(){return -1},create:function(a7,a8){if(typeof a7.url=="string"){a7.url=[a7.url]}a7.url=a7.url.map((function(a9){return this._extension.getURI(a9).toString()}).bind(this));var a5=a7.url.shift();var a6=j.open({url:a5,isPinned:a7.type=="popup",onOpen:function(a9){a7.url.forEach(function(ba){ad.open(ba)});if(typeof a8=="function"){a8(s(a9))}}})},remove:function(a5,a6){j.get(a5).close(function(a7){if(typeof a6=="function"){a6(s(a7))}})},get:function(a5,a6){if(typeof a6=="function"){a6(j.get(a5))}},getAll:function(a6,ba){var a9=typeof a6=="object"?a6&&a6.populate:false;var a5=[];for(var a7=0,a8=j.length;a7<a8;a7++){a5.push(j[a7])}ba(a5.map(function(bd){var be=s(bd);if(a9){be.tabs=[];for(var bb=0,bc=bd.tabs.length;bb<bc;bb++){be.tabs.push(r(bd.tabs[bb]))}}return be}))},getCurrent:function(a5,a6){if(typeof a6=="function"){if(this._extension.getBackgroundPage()==a5){this.getLastFocused(a6)}else{a6(s(a0({window:a5})))}}},getLastFocused:function(a6){var a5=j.activeWindow;if(typeof a6=="function"){a6(a5?s(a5):L.WINDOW_ID_NONE)}},update:function(a5,a6,a8){var a7=j.get(a5);if("focused" in a6){if(a6.focused){a7.activate()}else{if(au.length>1){this.windows.filter(function(a9){return a9!=a7}).sort(function(ba,a9){return ba.zIndex-a9.zIndex})[0].activate()}}}if(typeof a8=="function"){a8(s(a7))}}});const L=W.compose(aT,{constructor:function(a6,a5){this._extension=a6;return this._public},get au(){var a6=[];for(var a5=0,a7=j.length;a5<a7;a5++){a6.push(s(j[a5]))}return a6},start:function(a7){var a6=this;var a5=this._extension;j.on("open",function(a8){a5.dispatchEvent("windows:created",[s(a8)])});j.on("close",function(a8){a5.dispatchEvent("windows:removed",[s(a8)])});j.on("activate",function(a8){});ad.on("activate",function(a8){if(aR!=j.activeWindow){aR=j.activeWindow;aR.zIndex=b++;a5.dispatchEvent("windows:focusChanged",[s(aR)])}});if(typeof a7=="function"){a7(this)}}});const x=W.compose({_url:null,_container:"tab",get url(){return this._url},get container(){return this._container},get height(){return this._height},get width(){return this._width},constructor:function x(a7,a5){this._extension=a7;var a6=a5.launch;if("local_path" in a6){this._url=this._extension.getURL(a6.local_path)}if("web_url" in a6){this._url=a6.web_url}if(!this._url){throw new Error("Either 'app.launch.web_url' or 'app.launch.local_path') is required")}if("width" in a6){this._width=a6.width}if("height" in a6){this._height=a6.height}if("container" in a6){this._container=a6.container=="panel"?"panel":"tab"}return this._public},start:function A(){var a5="about:apps";this._pageOverride=F({newtab:a5}).start();ad.on("open",function(a7){var a8=a7.attach({contentScriptWhen:"end"})});if(this._extension.newInstalled){var a6=au.browserWindows.activeWindow;if(!Array.prototype.slice.call(a6.tabs,0).some(function(a7){if(a7.url==a5){a7.activate();a7.attach({contentScript:"location.reload()"});return true}return false})){ad.open({url:a5})}}}});const z={};var aJ=0;const Z=W.compose({create:function(a5,bd){var a6=Array.isArray(a5.documentUrlPatterns)?[aF.URLContext(a5.documentUrlPatterns.map(function(bf){return ac.parse(bf)}))]:[];var bb={link:"a",image:"img",audio:"audio",video:"video",editable:"input,textarea"};if(Array.isArray(a5.contexts)){var ba=[];var bc=[];if(a5.contexts.indexOf("all")!=-1){bc=["*"]}else{for(var a8 in bb){if(a5.contexts.indexOf(a8)!=-1){bc.push(bb[a8])}}}if(bc.length>0){ba.push(aF.SelectorContext(bc.join(","),Array.isArray(a5.targetUrlPatterns)?a5.targetUrlPatterns.map(function(bf){return ac.parse(bf)}):undefined))}if(a5.contexts.indexOf("selection")!=-1){ba.push(aF.SelectionContext())}if(a5.contexts.indexOf("page")!=-1){ba.push(aF.PageContext())}if(ba.length>0){if(ba.length>1){a6.push(aF.SomeContext(ba))}else{a6.push(ba[0])}}}var be={label:a5.title,context:a6,items:[],contentScript:'self.on("click", function (node, data) {var message={data:data,href:node.href,src:node.src,url:window.location.href,tagName:node.TagName,text:""+window.getSelection()}; self.postMessage(message);});',onMessage:function(bh,bi){var bg=z[bh.data];var bf={menuItemId:bg.id,editable:["INPUT","TEXTAREA"].indexOf(bh.tagName)!=-1,parentMenuItemId:this.parentMenu?this.parentMenu.id:undefined,};if(bh.href){bf.linkUrl=bh.href}if(bh.src){bf.srcUrl=bh.src}if(bh.tagName=="IMG"){bf.mediaType="image"}if(bh.tagName=="VIDEO"){bf.mediaType="video"}if(bh.tagName=="AUDIO"){bf.mediaType="audio"}if(bh.text){bf.selectionText=bh.text}if(bg.parentMenu){bf.parentMenuItemId=bg.parentMenu.id}if(typeof bg.onclick=="function"){bg.onclick(bf,r(bi.tab))}}};var a7;if("parentId" in a5){if(!(a5.parentId in z)){throw new Error("no menu with id:"+parentId)}var a9=z[a5.parentId];switch(a5.type){case"separator":a7=aF.Separator(be);break;case"normal":a7=aF.Item(be);if(a5.onclick){a7.onclick=a5.onclick}break;default:throw new Error("Error during contextMenus.create: this type is not supported :"+a5.type)}a9.addItem(a7)}else{a7=aF.Menu(be)}a7.id=aJ++;a7.data=a7.id;z[a7.id]=a7;if(typeof bd=="function"){bd()}return a7.id},remove:function(a5,a6){if(!(id in z)){throw new ("Error during contextMenus.remove: Cannot find menu item with id "+id)}z[a5].destroy();delete (z[id]);if(typeof a6=="function"){a6()}},removeAll:function(a7){for(var a6 in z){var a5=z[a6];if(!a5.parentMenu){a5.destroy();delete (z[a6])}}if(typeof a7=="function"){a7()}},update:function(a8,a5,a7){if(!(a8 in z)){throw new ("Error during contextMenus.update: Cannot find menu item with id "+a8)}var a6=z[a8];if("title" in a5){a6.label=a5.title}if("onclick " in a5){a6.onclick=a5.onclick}if("parentId" in a5){if(!(a5.parentId in z)){throw new ("Error during contextMenus.update: Cannot find menu item with id "+a8)}if(a6.parentMenu){a6.parentMenu.removeItem(a6)}z[a5.parentId].addItem(a6)}if(typeof a7=="function"){a7()}}});const K=W.compose(Z,{_extension:null,constructor:function Z(a5){this._extension=a5;return this._public},start:function(a5){},stop:function(){}});var X;const c=a1.cookie;const ar=a1.cs;const g=W.compose({get id(){return this._store.id},constructor:function i(a5){this._store=a5;return this._public}});const aG=W.compose({name:null,value:null,domain:null,hostOnly:false,path:null,secure:false,httpOnly:false,session:false,expirationDate:null,storeId:"0",constructor:function ai(a5){this._cookie=a5;this.name=a5.name;this.value=a5.value;this.domain=a5.host;this.hostOnly=a5.isHttpOnly;this.path=a5.path;this.secure=a5.isSecure;this.httpOnly=a5.isHttpOnly;this.session=a5.isSession;this.expirationDate=a5.expires;return this._public}});const ag=W.compose({get:function(a5,a6){if(typeof a6=="function"){this.getAll(a5,function(a7){a6(a7[0]||null)})}},getAll:function(a6,ba){var a7;if("url" in a6){var a5=aq.URL(a6.url);var a8=a5.host;var a9=a5.path;a7=this.getForHost(a8).filter(function(bb){return a9.indexOf(bb.path)==0})}if("domain" in a6){a7=a7?a7.filter(function(bb){var bc=a6.domain.lastIndexOf(bb.domain);return(bc!=-1)&&(a6.domain.length-bb.domain.length==bc)}):this.getForHost(a6.domain)}if(!a7){a7=this.cookies}if(a9){a7=a7.filter(function(bb){return bb.path==a9})}if("name" in a6){a7=a7.filter(function(bb){return bb.name==a6.name})}if("secure" in a6){a7=a7.filter(function(bb){return bb.secure==a6.secure})}if("session" in a6){a7=a7.filter(function(bb){return bb.session==a6.session})}if("storeId" in a6){a7=a7.filter(function(bb){return bb.storeId==a6.storeId})}a7.sort(function(bc,bb){return(bc.path.length-bb.path.length)});if(typeof ba=="function"){ba(a7)}},getAllChromeCookieStore:function(a5){if(typeof a5=="function"){a5(this.ChromeCookieStores)}},remove:function(a5,a6){this.get(a5,function(a7){if(a7){X=a7;X.operation="deleted";c.remove(a7.domain,a7.name,a7.path,false)}if(typeof a6=="function"){a6(a5)}})},set:function(a5,a8){var a6,a7;this.get(a5,(function(a9){if(a9){c.remove(a9.domain,a9.name,a9.path,false)}var ba=[[a5.name||"",a5.value||""].join("="),("domain" in a5)?("domain="+a5.domain):"",("path" in a5)?("path="+a5.path):"",("expirationDate" in a5)?("expires="+new Date(a5.expireationDate)):""].join(";");X={operation:"added",url:a5.url,domain:a5.domain,name:a5.name,path:a5.path||"/"};ar.setCookieString(a1.io.newURI(a5.url,null,null),null,ba,null);if(typeof a8=="function"){this.get(a5,a8)}}).bind(this))}});const aZ=W.compose(ag,{_extension:null,get ChromeCookieStores(){return[g({id:0})]},get cookies(){var a7=ar.enumerator;var a5=[];while(a7.hasMoreElements()){var a6=a7.getNext();av.queryInterface(a6,"nsICookie2");a5.push(aG(a6))}return a5},getForHost:function(a7){var a9=c.getCookiesFromHost(a7);var a5=[];while(a9.hasMoreElements()){var a6=a9.getNext();av.queryInterface(a6,"nsICookie2");var a8;if(a6.rawHost==a7||((a8=a7.lastIndexOf(a6.host))!=-1&&(a8==a7.length-a6.host.length))){a5.push(aG(a6))}}return a5},constructor:function aZ(a5){this._extension=a5;this._onCookieChange=(function(a7,ba){var a8=[];var a6;var a9="unknown";if(["deleted","added","changed"].indexOf(ba)!=-1){av.queryInterface(a7,"nsICookie2");a6=aG(a7);a9="overwrite";if(X){if(true||((("changed"==ba)||X.operation==ba))&&a6.name==X.name&&a6.value==X.value&&a6.path==X.path){a9="explicit"}else{console.warn("last explicit operation mismatch",X,a6)}}X=null}if("batch-deleted"==ba){a9="evicted";av.queryInterface(a7,"nsIArray");var bb=a7.enumerate();while(bb.hasMoreElements()){var a6=bb.getNext();av.queryInterface(a6,"nsICookie2");a8.push(aG(a6))}}(a8||[a6]).forEach((function(bc){this._extension.dispatchEvent("cookies:changed",[{removed:ba=="deleted"||ba=="batch-deleted",cookie:bc,cause:a9}])}).bind(this))}).bind(this);return this._public},start:function(a5){Y.add("cookie-changed",this._onCookieChange,this)},stop:function(){Y.remove("cookie-changed",this._onCookieChange)}});const a=function(a6){var a5=a1.history;switch(a6){case a5.TRANSITION_LINK:return"link";case a5.TRANSITION_BOOKMARK:return"auto_bookmark";case a5.TRANSITION_TYPED:return"typed";case a5.TRANSITION_FRAMED_LINK:return"manual_subframe";case a5.TRANSITION_EMBED:return"auto_subframe";default:return"link"}};const af=W.compose({id:null,url:null,title:null,lastVisitTime:null,visitCount:0,typedCount:0,constructor:function af(a5){this.id=a5.id||"0";this.url=a5.uri;this.title=a5.title||"";this.visitCount=a5.accessCount;this.lastVisitTime=a5.time/1000;return this._public}});const ax=W.compose({id:null,visitId:null,visitTime:null,referringVisitId:null,constructor:function ax(a5){this.id=a5.id;this.visitId=a5.visitId;this.visitTime=a5.time/1000;this.referringVisitId=a5.referringVisitId;return this._public}});const aU=W.compose({addUrl:function(a5){a1.history.addURI(a1.io.newURI(a5.url,null,null),false,true,null)},deleteAll:function(a5){a1.history.removeAll();if(typeof a5=="function"){a5()}},deleteRange:function(a5,a6){a1.history.removeVisitsByTimeframe(a5.startTime,a5.endTime);if(typeof a6=="function"){a6()}},deleteUrl:function(a5){a1.history.removePage(a1.io.newURI(a5.url,null,null))},getVisits:function(a5,ba){var a8=a1.history.getNewQuery();a8.uri=a1.io.newURI(a5.url,null,null);var bc=a1.history.getNewQueryOptions();bc.sortingMode=bc.SORT_BY_VISITCOUNT_DESCENDING;bc.resultType=bc.RESULTS_AS_VISIT;var bd=a1.history.executeQuery(a8,bc);var a7=[];var bb=bd.root;bb.containerOpen=true;for(var a6=0;a6<bb.childCount;++a6){var a9=bb.getChild(a6);av.queryInterface(a9,"nsINavHistoryVisitResultNode");a7.push(ax(a9))}if(typeof ba=="function"){ba(a7)}},search:function(a9,bb){var a8=a1.history.getNewQuery();var bd=a1.history.getNewQueryOptions();a8.searchTerms=a9.text;if("startTime" in a9){a8.beginTimeReference=a8.TIME_RELATIVE_EPOCH;a8.beginTime=a9.startTime}if("endTime" in a9){a8.beginTimeReference=a8.TIME_RELATIVE_EPOCH;a8.beginTime=a9.endTime}bd.sortingMode=bd.SORT_BY_VISITCOUNT_DESCENDING;if("sort" in a9){var a7="SORT_BY_"+a9.sort.toUpperCase();if(a7 in bd){bd.sortingMode=bd[a7]}}bd.resultType=bd.RESULTS_AS_URI;bd.maxResults=a9.maxResults||100;var be=a1.history.executeQuery(a8,bd);var a6=[];var bc=be.root;bc.containerOpen=true;for(var a5=0;a5<bc.childCount;++a5){var ba=bc.getChild(a5);a6.push(af(ba))}if(typeof bb=="function"){bb(a6)}}});const E=W.compose(aU,{_extension:null,constructor:function E(a5){this._extension=a5;return this._public},start:function(a5){a1.history.addObserver(this,false)},stop:function(){a1.history.removeObserver(this)},onBeforeDeleteURI:function(a6,a5){},onBeginUpdateBatch:function(a5){},onClearHistory:function(){this._extension.dispatchEvent("history:visitRemoved",[{allHistory:true}])},onDeleteURI:function(a6,a5){},onDeleteVisits:function(a7,a5,a6){this._extension.dispatchEvent("history:visited",[af({uri:a7.spec,id:a6,time:a5,title:a1.history.getPageTitle(a7)})])},onEndUpdateBatch:function(){},onPageChanged:function(a7,a5,a6){},onPageExpired:function(a7,a5,a6){},onTitleChanged:function(a6,a5){},onVisit:function(bb,a6,a8,bc,ba,a5,a9,a7){this._extension.dispatchEvent("history:visited",[af({uri:bb.spec,id:a6,time:a8,title:a1.history.getPageTitle(bb)})])}});const a3="extensions";const a2="chrome-extension";const N=10;const C="about:apps";if(!aC.storage.closedTabs){aC.storage.closedTabs=[]}const p=W.compose({_baseURI:null,__pageOverride:null,get defaultLocale(){return"en"},get extension(){return this._extension},unload:function(){var a5=this._public;J.engines=J.engines.filter(function(a6){return a6!=a5})},updateTabs:function(){for(var a9=0,ba=au.browserWindows.length;a9<ba;a9++){var a8=au.browserWindows[a9].tabs;for(var a7=0,a5=a8.length;a7<a5;a7++){var a6=a8[a7].url;if(a6==C){a8[a7].url=a8[a7].url}if(a6.indexOf(a2)!=-1){a8[a7].url=a8[a7].url}}}},constructor:function p(a9,a5){this._extension=a9;if(a5.overrideNewTab){this._pageOverride=F({newtab:C}).start();var a8="extensions.engine@extensionfactory.com.homepageset";if(!a4.has(a8)){a4.set("browser.startup.homepage",C);a4.set("browser.startup.page",1);a4.set(a8,true)}}am.register(a3,{newChannel:function(bg){try{switch(bg.host){case"engine":var bd=J.engines[0];if(bd){var bb=bd.getResourceURI(bg.path).toString();var ba=a1.io.newURI(bb,bg.originCharset,null);var bf=a1.io.newChannelFromURI(ba);bf.originalURI=bg;return bf}else{return a1.io.newChannel("data:text/plain,no%20active%20extension",null,null)}break;case"favicon":try{var bc=a1.favicon.getFaviconForPage(a1.io.newURI(bg.path.substring(1),null,null));var bf=a1.io.newChannelFromURI(bc);bf.originalURI=bg;return bf}catch(be){}return a1.io.newChannel("chrome://mozapps/skin/places/defaultFavicon.png",null,null);break;default:throw new Error("host not supported")}}catch(be){M.error(be);throw be}}});this._baseURI=a1.io.newURI(a3+"://"+this._extension.id.split("@")[0],null,null);var a7=this._public;J.engines=J.engines||[];J.engines.push(a7);an.ensure(this);if(!aC.storage.installed){aj.add(a5.gallery_url);aC.storage.installed=true}this._i18n=aB(this);this._history=E(this);this._pageMod=q({include:["about:apps",aK.data.url("*"),a3+"://*"],contentScriptWhen:"start",onContent:(function(bd){var bc=J.engines.map(function(bf){return bf.extension});var bb=bd.wrappedJSObject;var ba=bb.chrome=bb.chrome||{};ba.extension=ba.extension||{};var be=ba.extension.sendRequest||[];ba.management={launchApp:function(bk){var bm=bc[bc.map(function(bn){return bn.id}).indexOf(bk)];if(bm){if(bm.api.app.container=="panel"){const bf=a1.appshell.hiddenDOMWindow.screen;var bi="centerscreen,location=yes,width="+(bm.api.app.width||Math.floor(bf.width*0.8))+",height="+(bm.api.app.height||Math.floor(bf.height*0.8));var bh="about:blank";var bg=a1.ww.openWindow(null,bh,bm.manifest.name,bi,null);bg.addEventListener("load",function bj(bn){bg.location.replace(bm.api.app.url)},false)}else{var bl=a1.wm.getMostRecentWindow("navigator:browser");bl.gBrowser.selectedTab=bl.gBrowser.addTab(bm.api.app.url)}}},getAll:function(bf){return bf(bc.map(function(bg){return bg.info}))}};ba.history=this._history;ba.tabs=ba.tabs||{};ba.tabs.getRecentlyClosed=function(bf){if(typeof bf==="function"){bf(aC.storage.closedTabs)}};ba.i18n=this._i18n;ba.extension={sendRequest:function(bi,bh,bf){var bg=arguments;be.forEach(function(bj){bj.apply(this,bg)})}}}).bind(this),contentScript:"",onAttach:function(ba){ba.port.on("request",function(bc){var bb=bc.id;_this._extension.sendRequest(null,bc.request,function(){ba.port.emit("response",{id:bb,arguments:JSON.parse(JSON.stringify(Array.prototype.slice.call(arguments,0)))})},sender.tab)})}});var a6=(function(){this.updateTabs();Y.remove("chrome-document-global-created",a6)}).bind(this);Y.add("chrome-document-global-created",a6);ad.on("close",function(bb){if(/^about:/.test(bb.url)){return false}var bc=r(bb);var ba;if(aC.storage.closedTabs.some(function(bd,be){ba=be;return bd.url==bc.url})){aC.storage.closedTabs.splice(ba,1)}aC.storage.closedTabs.unshift(bc);if(aC.storage.closedTabs.length>N){aC.storage.closedTabs.splice(N)}});return this._public},getURL:function(a5){return aq.URL(a5,this._baseURI.spec)},getResourceURI:function(a5){return aq.URL(a5,aK.data.url(""))}});exports.Extension=aS;exports.Engine=p})();